<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulario de Suministro de Combustible</title>
    <style>
      /* Estilos generales para el body */
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
      }

      /* Estilos para el contenedor del formulario */
      .form-container {
        background-color: #ffffff;
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 2px solid #ffd200; /* Borde amarillo */
      }

      /* Estilo para el título del formulario */
      h1 {
        text-align: center;
        color: #333;
        font-size: 24px;
        margin-bottom: 20px;
      }

      /* Estilos para los formularios */
      form {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .form-group label {
        font-size: 14px;
        color: #333;
        text-align: left;
        font-weight: bold;
      }

      .form-group input[type="text"],
      .form-group input[type="number"],
      .form-group input[type="time"],
      .form-group input[type="date"],
      .form-group select,
      .form-group input[type="file"],
      .form-group textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
        font-size: 14px;
      }

      .form-group input[type="file"] {
        padding: 3px;
      }

      .form-group textarea {
        resize: vertical;
      }

      .form-group select {
        padding: 8px;
      }

      /* Estilo para el botón de envío */
      button[type="submit"] {
        display: block;
        width: 100%;
        padding: 10px;
        background-color: #333;
        color: #ffd200; /* Color amarillo */
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      /* Estilos para el hover en botones */
      button[type="submit"]:hover {
        background-color: #555;
      }

      /* Estilo para mostrar la dirección */
      .result-container {
        margin-top: 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="form-container">
      <h1>Formulario de Suministro de Combustible</h1>
      <form id="fuel-supply-form">
        <div class="form-group">
          <label for="date">Fecha:</label>
          <input type="date" id="date" name="date" required />
        </div>
        <div class="form-group">
          <label for="time">Hora:</label>
          <input type="time" id="time" name="time" required />
        </div>
        <div class="form-group">
          <label for="location">Ubicación:</label>
          <input type="text" id="location" name="location" readonly />
        </div>
        <div class="form-group">
          <label for="patrol">Patrulla:</label>
          <input type="text" id="patrol" name="patrol" required />
        </div>
        <div class="form-group">
          <label for="route">Ruta de Suministro:</label>
          <select id="route" name="route" required>
            <option value="">Seleccione una opción</option>
            <option value="norte">Norte</option>
            <option value="sur">Sur</option>
            <option value="centro">Centro</option>
            <option value="mecanizado">Mecanizado</option>
          </select>
        </div>
        <div class="form-group">
          <label for="operator">Operario:</label>
          <input type="text" id="operator" name="operator" required />
        </div>
        <div class="form-group">
          <label for="vehicle-plate">Placa del Vehículo:</label>
          <input type="text" id="vehicle-plate" name="vehicle-plate" required />
        </div>
        <div class="form-group">
          <label for="end-time">Hora de Término:</label>
          <input type="time" id="end-time" name="end-time" required />
        </div>
        <div class="form-group">
          <label for="observations">Observaciones:</label>
          <textarea id="observations" name="observations" rows="4"></textarea>
        </div>
        <div class="form-group">
          <label for="accompaniment">Acompañamiento en la Hacienda:</label>
          <input type="text" id="accompaniment" name="accompaniment" />
        </div>
        <div class="form-group">
          <label for="photos">Fotos:</label>
          <input
            type="file"
            id="photos"
            name="photos"
            accept="image/*"
            multiple
            required
          />
        </div>
        <button type="submit">Enviar</button>
      </form>
      <div class="result-container" id="result"></div>
    </div>

    <script>
      // Obtener la ubicación automática del usuario
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
          document.getElementById("location").value =
            "Geolocalización no soportada";
        }
      }

      function showPosition(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        document.getElementById("location").value = `Lat: ${lat}, Lon: ${lon}`;
      }

      function showError(error) {
        switch (error.code) {
          case error.PERMISSION_DENIED:
            document.getElementById("location").value = "Permiso denegado";
            break;
          case error.POSITION_UNAVAILABLE:
            document.getElementById("location").value =
              "Información no disponible";
            break;
          case error.TIMEOUT:
            document.getElementById("location").value = "La solicitud expiró";
            break;
          case error.UNKNOWN_ERROR:
            document.getElementById("location").value = "Error desconocido";
            break;
        }
      }

      // Convertir coordenadas en dirección utilizando OpenStreetMap Nominatim
      function getAddress(lat, lon) {
        fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`
        )
          .then((response) => response.json())
          .then((data) => {
            if (data && data.address) {
              const address = `${data.address.road || ""}, ${
                data.address.city || ""
              }, ${data.address.state || ""}, ${data.address.country || ""}`;
              document.getElementById(
                "result"
              ).innerHTML = `<h2>Ubicación del Suministro</h2><p>${address}</p>`;
            } else {
              document.getElementById("result").innerHTML =
                "<p>No se pudo obtener la dirección.</p>";
            }
          })
          .catch(() => {
            document.getElementById("result").innerHTML =
              "<p>No se pudo conectar con el servicio de geocodificación.</p>";
          });
      }

      // Ejecutar la función de geolocalización al cargar la página
      window.onload = function () {
        getLocation();
      };

      // Manejar el envío del formulario
      document
        .getElementById("fuel-supply-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          const locationValue = document.getElementById("location").value;

          if (locationValue && locationValue.startsWith("Lat:")) {
            const [lat, lon] = locationValue
              .replace("Lat: ", "")
              .replace("Lon: ", "")
              .split(", ")
              .map(Number);
            getAddress(lat, lon);
          } else {
            document.getElementById("result").innerHTML =
              "<p>La ubicación no está disponible.</p>";
          }
        });
    </script>
  </body>
</html>
